
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Fancytree - Example: ext-glyph - material design</title>

  <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
	<script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <!-- jquery-contextmenu (https://github.com/mar10/jquery-ui-contextmenu/) -->
	<script src="//cdn.jsdelivr.net/npm/ui-contextmenu/jquery.ui-contextmenu.min.js"></script>

	<link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="//code.getmdl.io/1.3.0/material.indigo-pink.min.css">
	<!-- <script defer src="//code.getmdl.io/1.3.0/material.min.js"></script> -->

	<link href="assets/src/skin-material/ui.fancytree.css" rel="stylesheet" class="skinswitcher">
	<script src="assets/src/jquery.fancytree.js"></script>
	<script src="assets/src/jquery.fancytree.glyph.js"></script>
  <script src="assets/src/jquery.fancytree.dnd.js"></script>
  <script src="assets/src/jquery.fancytree.edit.js"></script>
	<script src="assets/src/jquery.fancytree.table.js"></script>
	<script src="assets/src/jquery.fancytree.wide.js"></script>

<!-- Start_Exclude: This block is not part of the sample code -->
	<link href="assets/lib/prettify.css" rel="stylesheet">
	<script src="assets/lib/prettify.js"></script>
<!-- End_Exclude -->

<style type="text/css">
	ul.fancytree-container {
		width: 315px;
		border: 0;
		outline: 0;  /* No focus frame */
	}
	table.fancytree-container {
		table-layout: fixed;
		outline: 0;  /* No focus frame */
	}
</style>

<script type="text/javascript">
  var CLIPBOARD = null;
	$(function(){

		// --- Initialize Fancytree Grid -------------------------------------------
		$("#tree").fancytree({
			extensions: ["glyph", "wide"],
			debugLevel: 3,
			checkbox: true,
			selectMode: 3,
			tooltip: function(event, data) {
				var node = data.node,
					data = node.data;

				if( data.opts ) {
					return node.title + ", " + data.opts.opt_1 + ", " + data.opts.opt_2;
				}
			},
			glyph: {
				preset: "material",
				map: {}
			},
			source: {url: "assets/demo/ajax-tree-products.json", debugDelay: 1000},
			lazyLoad: function(event, data) {
				data.result = {url: "assets/demo/ajax-sub2.json", debugDelay: 1000};
			}
		});
		$("#btnReloadTree").click(function(){
			$.ui.fancytree.getTree(0).reload();
		});

		// --- Initialize Fancytree Grid -------------------------------------------
		$("#treegrid").fancytree({
			extensions: ["glyph", "table", "wide", "dnd", "edit"],
      dnd: {
  			preventVoidMoves: true,
  			preventRecursiveMoves: true,
  			autoExpandMS: 400,
  			dragStart: function(node, data) {
  				return true;
  			},
  			dragEnter: function(node, data) {
  				// return ["before", "after"];
  				return true;
  			},
  			dragDrop: function(node, data) {
  				data.otherNode.moveTo(node, data.hitMode);
  			}
  		},
      edit: {
  			triggerStart: ["f2", "shift+click", "mac+enter"],
  			close: function(event, data) {
  				if( data.save && data.isNew ){
  					// Quick-enter: add new nodes until we hit [enter] on an empty title
  					$("#tree").trigger("nodeCommand", {cmd: "addSibling"});
  				}
  			}
  		},
			checkbox: true,
			selectMode: 3,
			glyph: {
				preset: "material",
				map: {}
			},
			table: {
				checkboxColumnIdx: 0,
				nodeColumnIdx: 1
			},
			source: {url: "assets/demo/ajax-tree-products.json", debugDelay: 1000},
			lazyLoad: function(event, data) {
				data.result = {url: "assets/demo/ajax-sub2.json", debugDelay: 1000};
			},
  		createNode: function(event, data) {
  			var node = data.node,
  				$tdList = $(node.tr).find(">td");

  			// Span the remaining columns if it's a folder.
  			// We can do this in createNode instead of renderColumns, because
  			// the `isFolder` status is unlikely to change later
  			if( node.isFolder() ) {
  				$tdList.eq(2)
  					.prop("colspan", 6)
  					.nextAll().remove();
  			}
  		},
			renderColumns: function(event, data) {
				var node = data.node,
					data = node.data,
					$tdList = $(node.tr).find(">td");

        if( data.opts ) {
          /*$tdList.eq(2).html($('<input type="checkbox" />'));
          $tdList.eq(3).html($('<input type="checkbox" />'));
          $tdList.eq(4).html($('<input type="checkbox" />'));*/
				}
			}
		}).on("nodeCommand", function(event, data){
  		// Custom event handler that is triggered by keydown-handler and
  		// context menu:
  		var refNode, moveMode,
  			tree = $(this).fancytree("getTree"),
  			node = tree.getActiveNode();

  		switch( data.cmd ) {
  		case "moveUp":
  			refNode = node.getPrevSibling();
  			if( refNode ) {
  				node.moveTo(refNode, "before");
  				node.setActive();
  			}
  			break;
  		case "moveDown":
  			refNode = node.getNextSibling();
  			if( refNode ) {
  				node.moveTo(refNode, "after");
  				node.setActive();
  			}
  			break;
  		case "indent":
  			refNode = node.getPrevSibling();
  			if( refNode ) {
  				node.moveTo(refNode, "child");
  				refNode.setExpanded();
  				node.setActive();
  			}
  			break;
  		case "outdent":
  			if( !node.isTopLevel() ) {
  				node.moveTo(node.getParent(), "after");
  				node.setActive();
  			}
  			break;
  		case "rename":
  			node.editStart();
  			break;
  		case "remove":
  			refNode = node.getNextSibling() || node.getPrevSibling() || node.getParent();
  			node.remove();
  			if( refNode ) {
  				refNode.setActive();
  			}
  			break;
  		case "addChild":
  			node.editCreateNode("child", "");
  			break;
  		case "addSibling":
  			node.editCreateNode("after", "");
  			break;
  		case "cut":
  			CLIPBOARD = {mode: data.cmd, data: node};
  			break;
  		case "copy":
  			CLIPBOARD = {
  				mode: data.cmd,
  				data: node.toDict(function(n){
  					delete n.key;
  				})
  			};
  			break;
  		case "clear":
  			CLIPBOARD = null;
  			break;
  		case "paste":
  			if( CLIPBOARD.mode === "cut" ) {
  				// refNode = node.getPrevSibling();
  				CLIPBOARD.data.moveTo(node, "child");
  				CLIPBOARD.data.setActive();
  			} else if( CLIPBOARD.mode === "copy" ) {
  				node.addChildren(CLIPBOARD.data).setActive();
  			}
  			break;
  		default:
  			alert("Unhandled command: " + data.cmd);
  			return;
  		}

  	// }).on("click dblclick", function(e){
  	// 	console.log( e, $.ui.fancytree.eventToString(e) );

  	}).on("keydown", function(e){
  		var cmd = null;

  		// console.log(e.type, $.ui.fancytree.eventToString(e));
  		switch( $.ui.fancytree.eventToString(e) ) {
  		case "ctrl+shift+n":
  		case "meta+shift+n": // mac: cmd+shift+n
  			cmd = "addChild";
  			break;
  		case "ctrl+c":
  		case "meta+c": // mac
  			cmd = "copy";
  			break;
  		case "ctrl+v":
  		case "meta+v": // mac
  			cmd = "paste";
  			break;
  		case "ctrl+x":
  		case "meta+x": // mac
  			cmd = "cut";
  			break;
  		case "ctrl+n":
  		case "meta+n": // mac
  			cmd = "addSibling";
  			break;
  		case "del":
  		case "meta+backspace": // mac
  			cmd = "remove";
  			break;
  		// case "f2":  // already triggered by ext-edit pluging
  		// 	cmd = "rename";
  		// 	break;
  		case "ctrl+up":
  			cmd = "moveUp";
  			break;
  		case "ctrl+down":
  			cmd = "moveDown";
  			break;
  		case "ctrl+right":
  		case "ctrl+shift+right": // mac
  			cmd = "indent";
  			break;
  		case "ctrl+left":
  		case "ctrl+shift+left": // mac
  			cmd = "outdent";
  		}
  		if( cmd ){
  			$(this).trigger("nodeCommand", {cmd: cmd});
  			// e.preventDefault();
  			// e.stopPropagation();
  			return false;
  		}
  	});
		$("#btnGridExpandAll").click(function(){
			$.ui.fancytree.getTree(1).visit(function(node){
				node.setExpanded();
			});
		});
		$("#btnGridCollapseAll").click(function(){
			$.ui.fancytree.getTree(1).visit(function(node){
				node.setExpanded(false);
			});
		});

    /*
	 * Context menu (https://github.com/mar10/jquery-ui-contextmenu)
	 */
	$("#treegrid").contextmenu({
		delegate: "span.fancytree-node",
		menu: [
			{title: "Edit <kbd>[F2]</kbd>", cmd: "rename", uiIcon: "ui-icon-pencil" },
			{title: "Delete <kbd>[Del]</kbd>", cmd: "remove", uiIcon: "ui-icon-trash" },
			{title: "----"},
			{title: "New sibling <kbd>[Ctrl+N]</kbd>", cmd: "addSibling", uiIcon: "ui-icon-plus" },
			{title: "New child <kbd>[Ctrl+Shift+N]</kbd>", cmd: "addChild", uiIcon: "ui-icon-arrowreturn-1-e" },
			{title: "----"},
			{title: "Cut <kbd>Ctrl+X</kbd>", cmd: "cut", uiIcon: "ui-icon-scissors"},
			{title: "Copy <kbd>Ctrl-C</kbd>", cmd: "copy", uiIcon: "ui-icon-copy"},
			{title: "Paste as child<kbd>Ctrl+V</kbd>", cmd: "paste", uiIcon: "ui-icon-clipboard", disabled: true }
			],
		beforeOpen: function(event, ui) {
			var node = $.ui.fancytree.getNode(ui.target);
			$("#treegrid").contextmenu("enableEntry", "paste", !!CLIPBOARD);
			node.setActive();
		},
		select: function(event, ui) {
			var that = this;
			// delay the event, so the menu can close and the click event does
			// not interfere with the edit control
			setTimeout(function(){
				$(that).trigger("nodeCommand", {cmd: ui.cmd});
			}, 100);
		}
	});
	});
</script>
</head>

<body class="example">

	<!-- <div id="tree" class="demo-card-wide mdl-card mdl-shadow--2dp"> -->
	<div id="tree" style="display: none">
	</div>

	<hr>

	<!-- Accent-colored raised button with ripple -->
	<button id="btnGridExpandAll"
		class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
	  Expand all
	</button>
	<button id="btnGridCollapseAll"
		class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
	  Collapse all
	</button>

	<table id="treegrid" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
	<!-- <table id="treegrid" class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp"> -->
	  <colgroup>
		<col style="width: 40px;">
		<col style="width: 400px;">
		<col style="width: 80px;">
		<col style="width: 80px;">
		<col style="width: 80px;">
	  </colgroup>
	  <thead>
		<tr>
		  <!-- NOTE: the first column will be inserted by MDL if mdl-data-table--selectable is set. -->
		  <th class="mdl-data-table__cell--non-numeric"></th>
		  <th class="mdl-data-table__cell--non-numeric">Item</th>
		  <th>Cảm nhận</th>
		  <th>Diễn đạt</th>
		  <th>Viết</th>
		</tr>
	  </thead>
	  <tbody>
		  <tr>
			  <td class="mdl-data-table__cell--non-numeric"></td>
			  <td class="mdl-data-table__cell--non-numeric"><input name="input1" type="input" style="width: 400px"></td>
			  <td><input name="cb1" type="checkbox"></td>
			  <td><input name="cb2" type="checkbox"></td>
			  <td><input name="cb3" type="checkbox"></td>
		  </tr>
	  </tbody>
	</table>
</body>
</html>
